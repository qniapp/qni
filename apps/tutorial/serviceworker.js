"use strict";(()=>{var Vt=Object.create;var dt=Object.defineProperty;var Zt=Object.getOwnPropertyDescriptor;var Lt=Object.getOwnPropertyNames;var Qt=Object.getPrototypeOf,Xt=Object.prototype.hasOwnProperty;var p=(i,t)=>dt(i,"name",{value:t,configurable:!0});var Ht=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports);var Jt=(i,t,r,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Lt(t))!Xt.call(i,n)&&n!==r&&dt(i,n,{get:()=>t[n],enumerable:!(e=Zt(t,n))||e.enumerable});return i};var Yt=(i,t,r)=>(r=i!=null?Vt(Qt(i)):{},Jt(t||!i||!i.__esModule?dt(r,"default",{value:i,enumerable:!0}):r,i));var qt=Ht((bt,Ct)=>{(function(i){"use strict";var t=2e3,r={s:1,n:0,d:1};function e(h,l){if(isNaN(h=parseInt(h,10)))throw g.InvalidParameter;return h*l}p(e,"assign");function n(h,l){if(l===0)throw g.DivisionByZero;var a=Object.create(g.prototype);a.s=h<0?-1:1,h=h<0?-h:h;var s=y(h,l);return a.n=h/s,a.d=l/s,a}p(n,"newFraction");function o(h){for(var l={},a=h,s=2,u=4;u<=a;){for(;a%s===0;)a/=s,l[s]=(l[s]||0)+1;u+=1+2*s++}return a!==h?a>1&&(l[a]=(l[a]||0)+1):l[h]=(l[h]||0)+1,l}p(o,"factorize");var f=p(function(h,l){var a=0,s=1,u=1,d=0,v=0,N=0,A=1,S=1,M=0,E=1,w=1,b=1,C=1e7,k;if(h!=null)if(l!==void 0){if(a=h,s=l,u=a*s,a%1!==0||s%1!==0)throw g.NonIntegerParameter}else switch(typeof h){case"object":{if("d"in h&&"n"in h)a=h.n,s=h.d,"s"in h&&(a*=h.s);else if(0 in h)a=h[0],1 in h&&(s=h[1]);else throw g.InvalidParameter;u=a*s;break}case"number":{if(h<0&&(u=h,h=-h),h%1===0)a=h;else if(h>0){for(h>=1&&(S=Math.pow(10,Math.floor(1+Math.log(h)/Math.LN10)),h/=S);E<=C&&b<=C;)if(k=(M+w)/(E+b),h===k){E+b<=C?(a=M+w,s=E+b):b>E?(a=w,s=b):(a=M,s=E);break}else h>k?(M+=w,E+=b):(w+=M,b+=E),E>C?(a=w,s=b):(a=M,s=E);a*=S}else(isNaN(h)||isNaN(l))&&(s=a=NaN);break}case"string":{if(E=h.match(/\d+|./g),E===null)throw g.InvalidParameter;if(E[M]==="-"?(u=-1,M++):E[M]==="+"&&M++,E.length===M+1?v=e(E[M++],u):E[M+1]==="."||E[M]==="."?(E[M]!=="."&&(d=e(E[M++],u)),M++,(M+1===E.length||E[M+1]==="("&&E[M+3]===")"||E[M+1]==="'"&&E[M+3]==="'")&&(v=e(E[M],u),A=Math.pow(10,E[M].length),M++),(E[M]==="("&&E[M+2]===")"||E[M]==="'"&&E[M+2]==="'")&&(N=e(E[M+1],u),S=Math.pow(10,E[M+1].length)-1,M+=3)):E[M+1]==="/"||E[M+1]===":"?(v=e(E[M],u),A=e(E[M+2],1),M+=3):E[M+3]==="/"&&E[M+1]===" "&&(d=e(E[M],u),v=e(E[M+2],u),A=e(E[M+4],1),M+=5),E.length<=M){s=A*S,u=a=N+s*d+S*v;break}}default:throw g.InvalidParameter}if(s===0)throw g.DivisionByZero;r.s=u<0?-1:1,r.n=Math.abs(a),r.d=Math.abs(s)},"parse");function m(h,l,a){for(var s=1;l>0;h=h*h%a,l>>=1)l&1&&(s=s*h%a);return s}p(m,"modpow");function x(h,l){for(;l%2===0;l/=2);for(;l%5===0;l/=5);if(l===1)return 0;for(var a=10%l,s=1;a!==1;s++)if(a=a*10%l,s>t)return 0;return s}p(x,"cycleLen");function c(h,l,a){for(var s=1,u=m(10,a,l),d=0;d<300;d++){if(s===u)return d;s=s*10%l,u=u*10%l}return 0}p(c,"cycleStart");function y(h,l){if(!h)return l;if(!l)return h;for(;;){if(h%=l,!h)return l;if(l%=h,!l)return h}}p(y,"gcd");function g(h,l){if(f(h,l),this instanceof g)h=y(r.d,r.n),this.s=r.s,this.n=r.n/h,this.d=r.d/h;else return n(r.s*r.n,r.d)}p(g,"Fraction"),g.DivisionByZero=new Error("Division by Zero"),g.InvalidParameter=new Error("Invalid argument"),g.NonIntegerParameter=new Error("Parameters must be integer"),g.prototype={s:1,n:0,d:1,abs:function(){return n(this.n,this.d)},neg:function(){return n(-this.s*this.n,this.d)},add:function(h,l){return f(h,l),n(this.s*this.n*r.d+r.s*this.d*r.n,this.d*r.d)},sub:function(h,l){return f(h,l),n(this.s*this.n*r.d-r.s*this.d*r.n,this.d*r.d)},mul:function(h,l){return f(h,l),n(this.s*r.s*this.n*r.n,this.d*r.d)},div:function(h,l){return f(h,l),n(this.s*r.s*this.n*r.d,this.d*r.n)},clone:function(){return n(this.s*this.n,this.d)},mod:function(h,l){if(isNaN(this.n)||isNaN(this.d))return new g(NaN);if(h===void 0)return n(this.s*this.n%this.d,1);if(f(h,l),r.n===0&&this.d===0)throw g.DivisionByZero;return n(this.s*(r.d*this.n)%(r.n*this.d),r.d*this.d)},gcd:function(h,l){return f(h,l),n(y(r.n,this.n)*y(r.d,this.d),r.d*this.d)},lcm:function(h,l){return f(h,l),r.n===0&&this.n===0?n(0,1):n(r.n*this.n,y(r.n,this.n)*y(r.d,this.d))},ceil:function(h){return h=Math.pow(10,h||0),isNaN(this.n)||isNaN(this.d)?new g(NaN):n(Math.ceil(h*this.s*this.n/this.d),h)},floor:function(h){return h=Math.pow(10,h||0),isNaN(this.n)||isNaN(this.d)?new g(NaN):n(Math.floor(h*this.s*this.n/this.d),h)},round:function(h){return h=Math.pow(10,h||0),isNaN(this.n)||isNaN(this.d)?new g(NaN):n(Math.round(h*this.s*this.n/this.d),h)},inverse:function(){return n(this.s*this.d,this.n)},pow:function(h,l){if(f(h,l),r.d===1)return r.s<0?n(Math.pow(this.s*this.d,r.n),Math.pow(this.n,r.n)):n(Math.pow(this.s*this.n,r.n),Math.pow(this.d,r.n));if(this.s<0)return null;var a=o(this.n),s=o(this.d),u=1,d=1;for(var v in a)if(v!=="1"){if(v==="0"){u=0;break}if(a[v]*=r.n,a[v]%r.d===0)a[v]/=r.d;else return null;u*=Math.pow(v,a[v])}for(var v in s)if(v!=="1"){if(s[v]*=r.n,s[v]%r.d===0)s[v]/=r.d;else return null;d*=Math.pow(v,s[v])}return r.s<0?n(d,u):n(u,d)},equals:function(h,l){return f(h,l),this.s*this.n*r.d===r.s*r.n*this.d},compare:function(h,l){f(h,l);var a=this.s*this.n*r.d-r.s*r.n*this.d;return(0<a)-(a<0)},simplify:function(h){if(isNaN(this.n)||isNaN(this.d))return this;h=h||.001;for(var l=this.abs(),a=l.toContinued(),s=1;s<a.length;s++){for(var u=n(a[s-1],1),d=s-2;d>=0;d--)u=u.inverse().add(a[d]);if(u.sub(l).abs().valueOf()<h)return u.mul(this.s)}return this},divisible:function(h,l){return f(h,l),!(!(r.n*this.d)||this.n*r.d%(r.n*this.d))},valueOf:function(){return this.s*this.n/this.d},toFraction:function(h){var l,a="",s=this.n,u=this.d;return this.s<0&&(a+="-"),u===1?a+=s:(h&&(l=Math.floor(s/u))>0&&(a+=l,a+=" ",s%=u),a+=s,a+="/",a+=u),a},toLatex:function(h){var l,a="",s=this.n,u=this.d;return this.s<0&&(a+="-"),u===1?a+=s:(h&&(l=Math.floor(s/u))>0&&(a+=l,s%=u),a+="\\frac{",a+=s,a+="}{",a+=u,a+="}"),a},toContinued:function(){var h,l=this.n,a=this.d,s=[];if(isNaN(l)||isNaN(a))return s;do s.push(Math.floor(l/a)),h=l%a,l=a,a=h;while(l!==1);return s},toString:function(h){var l=this.n,a=this.d;if(isNaN(l)||isNaN(a))return"NaN";h=h||15;var s=x(l,a),u=c(l,a,s),d=this.s<0?"-":"";if(d+=l/a|0,l%=a,l*=10,l&&(d+="."),s){for(var v=u;v--;)d+=l/a|0,l%=a,l*=10;d+="(";for(var v=s;v--;)d+=l/a|0,l%=a,l*=10;d+=")"}else for(var v=h;l&&v--;)d+=l/a|0,l%=a,l*=10;return d}},typeof define=="function"&&define.amd?define([],function(){return g}):typeof bt=="object"?(Object.defineProperty(g,"__esModule",{value:!0}),g.default=g,g.Fraction=g,Ct.exports=g):i.Fraction=g})(bt)});var Kt=p(function(i){return function(t){for(var r=Math.max(0,Math.floor(t)),e=[i(0)],n=1;n<r;n++)e.push(i(n));return e}},"makeBy");var st=p(function(i,t){return i<=t?Kt(function(r){return i+r})(t-i+1):[i]},"range");var tr=Object.create,At=Object.defineProperty,rr=Object.getOwnPropertyDescriptor,er=Object.getOwnPropertyNames,nr=Object.getPrototypeOf,ir=Object.prototype.hasOwnProperty,ar=p((i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports),"rr"),or=p((i,t,r,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of er(t))!ir.call(i,n)&&n!==r&&At(i,n,{get:()=>t[n],enumerable:!(e=rr(t,n))||e.enumerable});return i},"er"),sr=p((i,t,r)=>(r=i!=null?tr(nr(i)):{},or(t||!i||!i.__esModule?At(r,"default",{value:i,enumerable:!0}):r,i)),"ir"),ur=ar((i,t)=>{(function(r){"use strict";var e=2e3,n={s:1,n:0,d:1};function o(a,s){if(isNaN(a=parseInt(a,10)))throw l.InvalidParameter;return a*s}p(o,"e");function f(a,s){if(s===0)throw l.DivisionByZero;var u=Object.create(l.prototype);u.s=a<0?-1:1,a=a<0?-a:a;var d=h(a,s);return u.n=a/d,u.d=s/d,u}p(f,"i");function m(a){for(var s={},u=a,d=2,v=4;v<=u;){for(;u%d===0;)u/=d,s[d]=(s[d]||0)+1;v+=1+2*d++}return u!==a?u>1&&(s[u]=(s[u]||0)+1):s[a]=(s[a]||0)+1,s}p(m,"n");var x=p(function(a,s){var u=0,d=1,v=1,N=0,A=0,S=0,M=1,E=1,w=0,b=1,C=1,k=1,B=1e7,ct;if(a!=null)if(s!==void 0){if(u=a,d=s,v=u*d,u%1!==0||d%1!==0)throw l.NonIntegerParameter}else switch(typeof a){case"object":{if("d"in a&&"n"in a)u=a.n,d=a.d,"s"in a&&(u*=a.s);else if(0 in a)u=a[0],1 in a&&(d=a[1]);else throw l.InvalidParameter;v=u*d;break}case"number":{if(a<0&&(v=a,a=-a),a%1===0)u=a;else if(a>0){for(a>=1&&(E=Math.pow(10,Math.floor(1+Math.log(a)/Math.LN10)),a/=E);b<=B&&k<=B;)if(ct=(w+C)/(b+k),a===ct){b+k<=B?(u=w+C,d=b+k):k>b?(u=C,d=k):(u=w,d=b);break}else a>ct?(w+=C,b+=k):(C+=w,k+=b),b>B?(u=C,d=k):(u=w,d=b);u*=E}else(isNaN(a)||isNaN(s))&&(d=u=NaN);break}case"string":{if(b=a.match(/\d+|./g),b===null)throw l.InvalidParameter;if(b[w]==="-"?(v=-1,w++):b[w]==="+"&&w++,b.length===w+1?A=o(b[w++],v):b[w+1]==="."||b[w]==="."?(b[w]!=="."&&(N=o(b[w++],v)),w++,(w+1===b.length||b[w+1]==="("&&b[w+3]===")"||b[w+1]==="'"&&b[w+3]==="'")&&(A=o(b[w],v),M=Math.pow(10,b[w].length),w++),(b[w]==="("&&b[w+2]===")"||b[w]==="'"&&b[w+2]==="'")&&(S=o(b[w+1],v),E=Math.pow(10,b[w+1].length)-1,w+=3)):b[w+1]==="/"||b[w+1]===":"?(A=o(b[w],v),M=o(b[w+2],1),w+=3):b[w+3]==="/"&&b[w+1]===" "&&(N=o(b[w],v),A=o(b[w+2],v),M=o(b[w+4],1),w+=5),b.length<=w){d=M*E,v=u=S+d*N+E*A;break}}default:throw l.InvalidParameter}if(d===0)throw l.DivisionByZero;n.s=v<0?-1:1,n.n=Math.abs(u),n.d=Math.abs(d)},"h");function c(a,s,u){for(var d=1;s>0;a=a*a%u,s>>=1)s&1&&(d=d*a%u);return d}p(c,"b");function y(a,s){for(;s%2===0;s/=2);for(;s%5===0;s/=5);if(s===1)return 0;for(var u=10%s,d=1;u!==1;d++)if(u=u*10%s,d>e)return 0;return d}p(y,"y");function g(a,s,u){for(var d=1,v=c(10,u,s),N=0;N<300;N++){if(d===v)return N;d=d*10%s,v=v*10%s}return 0}p(g,"f");function h(a,s){if(!a)return s;if(!s)return a;for(;;){if(a%=s,!a)return s;if(s%=a,!s)return a}}p(h,"w");function l(a,s){if(x(a,s),this instanceof l)a=h(n.d,n.n),this.s=n.s,this.n=n.n/a,this.d=n.d/a;else return f(n.s*n.n,n.d)}p(l,"d"),l.DivisionByZero=new Error("Division by Zero"),l.InvalidParameter=new Error("Invalid argument"),l.NonIntegerParameter=new Error("Parameters must be integer"),l.prototype={s:1,n:0,d:1,abs:function(){return f(this.n,this.d)},neg:function(){return f(-this.s*this.n,this.d)},add:function(a,s){return x(a,s),f(this.s*this.n*n.d+n.s*this.d*n.n,this.d*n.d)},sub:function(a,s){return x(a,s),f(this.s*this.n*n.d-n.s*this.d*n.n,this.d*n.d)},mul:function(a,s){return x(a,s),f(this.s*n.s*this.n*n.n,this.d*n.d)},div:function(a,s){return x(a,s),f(this.s*n.s*this.n*n.d,this.d*n.n)},clone:function(){return f(this.s*this.n,this.d)},mod:function(a,s){if(isNaN(this.n)||isNaN(this.d))return new l(NaN);if(a===void 0)return f(this.s*this.n%this.d,1);if(x(a,s),n.n===0&&this.d===0)throw l.DivisionByZero;return f(this.s*(n.d*this.n)%(n.n*this.d),n.d*this.d)},gcd:function(a,s){return x(a,s),f(h(n.n,this.n)*h(n.d,this.d),n.d*this.d)},lcm:function(a,s){return x(a,s),n.n===0&&this.n===0?f(0,1):f(n.n*this.n,h(n.n,this.n)*h(n.d,this.d))},ceil:function(a){return a=Math.pow(10,a||0),isNaN(this.n)||isNaN(this.d)?new l(NaN):f(Math.ceil(a*this.s*this.n/this.d),a)},floor:function(a){return a=Math.pow(10,a||0),isNaN(this.n)||isNaN(this.d)?new l(NaN):f(Math.floor(a*this.s*this.n/this.d),a)},round:function(a){return a=Math.pow(10,a||0),isNaN(this.n)||isNaN(this.d)?new l(NaN):f(Math.round(a*this.s*this.n/this.d),a)},inverse:function(){return f(this.s*this.d,this.n)},pow:function(a,s){if(x(a,s),n.d===1)return n.s<0?f(Math.pow(this.s*this.d,n.n),Math.pow(this.n,n.n)):f(Math.pow(this.s*this.n,n.n),Math.pow(this.d,n.n));if(this.s<0)return null;var u=m(this.n),d=m(this.d),v=1,N=1;for(var A in u)if(A!=="1"){if(A==="0"){v=0;break}if(u[A]*=n.n,u[A]%n.d===0)u[A]/=n.d;else return null;v*=Math.pow(A,u[A])}for(var A in d)if(A!=="1"){if(d[A]*=n.n,d[A]%n.d===0)d[A]/=n.d;else return null;N*=Math.pow(A,d[A])}return n.s<0?f(N,v):f(v,N)},equals:function(a,s){return x(a,s),this.s*this.n*n.d===n.s*n.n*this.d},compare:function(a,s){x(a,s);var u=this.s*this.n*n.d-n.s*n.n*this.d;return(0<u)-(u<0)},simplify:function(a){if(isNaN(this.n)||isNaN(this.d))return this;a=a||.001;for(var s=this.abs(),u=s.toContinued(),d=1;d<u.length;d++){for(var v=f(u[d-1],1),N=d-2;N>=0;N--)v=v.inverse().add(u[N]);if(v.sub(s).abs().valueOf()<a)return v.mul(this.s)}return this},divisible:function(a,s){return x(a,s),!(!(n.n*this.d)||this.n*n.d%(n.n*this.d))},valueOf:function(){return this.s*this.n/this.d},toFraction:function(a){var s,u="",d=this.n,v=this.d;return this.s<0&&(u+="-"),v===1?u+=d:(a&&(s=Math.floor(d/v))>0&&(u+=s,u+=" ",d%=v),u+=d,u+="/",u+=v),u},toLatex:function(a){var s,u="",d=this.n,v=this.d;return this.s<0&&(u+="-"),v===1?u+=d:(a&&(s=Math.floor(d/v))>0&&(u+=s,d%=v),u+="\\frac{",u+=d,u+="}{",u+=v,u+="}"),u},toContinued:function(){var a,s=this.n,u=this.d,d=[];if(isNaN(s)||isNaN(u))return d;do d.push(Math.floor(s/u)),a=s%u,s=u,u=a;while(s!==1);return d},toString:function(a){var s=this.n,u=this.d;if(isNaN(s)||isNaN(u))return"NaN";a=a||15;var d=y(s,u),v=g(s,u,d),N=this.s<0?"-":"";if(N+=s/u|0,s%=u,s*=10,s&&(N+="."),d){for(var A=v;A--;)N+=s/u|0,s%=u,s*=10;N+="(";for(var A=d;A--;)N+=s/u|0,s%=u,s*=10;N+=")"}else for(var A=a;s&&A--;)N+=s/u|0,s%=u,s*=10;return N}},typeof define=="function"&&define.amd?define([],function(){return l}):typeof i=="object"?(Object.defineProperty(l,"__esModule",{value:!0}),l.default=l,l.Fraction=l,t.exports=l):r.Fraction=l})(i)}),hr=sr(ur());function pt(i,t,r,e){function n(o){return o instanceof r?o:new r(function(f){f(o)})}return p(n,"i"),new(r||(r=Promise))(function(o,f){function m(y){try{c(e.next(y))}catch(g){f(g)}}p(m,"b");function x(y){try{c(e.throw(y))}catch(g){f(g)}}p(x,"y");function c(y){y.done?o(y.value):n(y.value).then(m,x)}p(c,"f"),c((e=e.apply(i,t||[])).next())})}p(pt,"W");function vt(i,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},e,n,o,f;return f={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function m(c){return function(y){return x([c,y])}}function x(c){if(e)throw new TypeError("Generator is already executing.");for(;r;)try{if(e=1,n&&(o=c[0]&2?n.return:c[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,c[1])).done)return o;switch(n=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,n=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){r.label=c[1];break}if(c[0]===6&&r.label<o[1]){r.label=o[1],o=c;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(c);break}o[2]&&r.ops.pop(),r.trys.pop();continue}c=t.call(i,r)}catch(y){c=[6,y],n=0}finally{e=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}p(vt,"Y");function ut(i,t){var r=typeof Symbol=="function"&&i[Symbol.iterator];if(!r)return i;var e=r.call(i),n,o=[],f;try{for(;(t===void 0||t-- >0)&&!(n=e.next()).done;)o.push(n.value)}catch(m){f={error:m}}finally{try{n&&!n.done&&(r=e.return)&&r.call(e)}finally{if(f)throw f.error}}return o}p(ut,"Q");function Q(i,t,r){if(r||arguments.length===2)for(var e=0,n=t.length,o;e<n;e++)(o||!(e in t))&&(o||(o=Array.prototype.slice.call(t,0,e)),o[e]=t[e]);return i.concat(o||Array.prototype.slice.call(t))}p(Q,"_");var lr={withStackTrace:!1},Nt=p(function(i,t,r){r===void 0&&(r=lr);var e=t.isOk()?{type:"Ok",value:t.value}:{type:"Err",value:t.error},n=r.withStackTrace?new Error().stack:void 0;return{data:e,message:i,stack:n}},"st"),tt=function(){function i(t){this._promise=t}return p(i,"s"),i.fromSafePromise=function(t){var r=t.then(function(e){return new V(e)});return new i(r)},i.fromPromise=function(t,r){var e=t.then(function(n){return new V(n)}).catch(function(n){return new L(r(n))});return new i(e)},i.combine=function(t){return cr(t)},i.combineWithAllErrors=function(t){return dr(t)},i.prototype.map=function(t){var r=this;return new i(this._promise.then(function(e){return pt(r,void 0,void 0,function(){var n;return vt(this,function(o){switch(o.label){case 0:return e.isErr()?[2,new L(e.error)]:(n=V.bind,[4,t(e.value)]);case 1:return[2,new(n.apply(V,[void 0,o.sent()]))]}})})}))},i.prototype.mapErr=function(t){var r=this;return new i(this._promise.then(function(e){return pt(r,void 0,void 0,function(){var n;return vt(this,function(o){switch(o.label){case 0:return e.isOk()?[2,new V(e.value)]:(n=L.bind,[4,t(e.error)]);case 1:return[2,new(n.apply(L,[void 0,o.sent()]))]}})})}))},i.prototype.andThen=function(t){return new i(this._promise.then(function(r){if(r.isErr())return new L(r.error);var e=t(r.value);return e instanceof i?e._promise:e}))},i.prototype.orElse=function(t){var r=this;return new i(this._promise.then(function(e){return pt(r,void 0,void 0,function(){return vt(this,function(n){return e.isErr()?[2,t(e.error)]:[2,new V(e.value)]})})}))},i.prototype.match=function(t,r){return this._promise.then(function(e){return e.match(t,r)})},i.prototype.unwrapOr=function(t){return this._promise.then(function(r){return r.unwrapOr(t)})},i.prototype.then=function(t,r){return this._promise.then(t,r)},i}(),Et=p(function(i){return new tt(Promise.resolve(new L(i)))},"at"),he=tt.fromPromise,le=tt.fromSafePromise,fr=p(function(i){return function(t){return Q(Q([],ut(t),!1),[i],!1)}},"ar"),St=p(function(i){return i.reduce(function(t,r){return t.isOk()?r.isErr()?I(r.error):t.map(fr(r.value)):t},R([]))},"ot"),cr=p(function(i){return tt.fromSafePromise(Promise.all(i)).andThen(St)},"sr"),Ot=p(function(i){return i.reduce(function(t,r){return r.isErr()?t.isErr()?I(Q(Q([],ut(t.error),!1),[r.error],!1)):I([r.error]):t.isErr()?t:R(Q(Q([],ut(t.value),!1),[r.value],!1))},R([]))},"ut"),dr=p(function(i){return tt.fromSafePromise(Promise.all(i)).andThen(Ot)},"or"),ht;(function(i){function t(n,o){return function(){for(var f=[],m=0;m<arguments.length;m++)f[m]=arguments[m];try{var x=n.apply(void 0,Q([],ut(f),!1));return R(x)}catch(c){return I(o?o(c):c)}}}p(t,"r"),i.fromThrowable=t;function r(n){return St(n)}p(r,"t"),i.combine=r;function e(n){return Ot(n)}p(e,"e"),i.combineWithAllErrors=e})(ht||(ht={}));var R=p(function(i){return new V(i)},"A"),I=p(function(i){return new L(i)},"S"),V=function(){function i(t){this.value=t}return p(i,"s"),i.prototype.isOk=function(){return!0},i.prototype.isErr=function(){return!this.isOk()},i.prototype.map=function(t){return R(t(this.value))},i.prototype.mapErr=function(t){return R(this.value)},i.prototype.andThen=function(t){return t(this.value)},i.prototype.orElse=function(t){return R(this.value)},i.prototype.asyncAndThen=function(t){return t(this.value)},i.prototype.asyncMap=function(t){return tt.fromSafePromise(t(this.value))},i.prototype.unwrapOr=function(t){return this.value},i.prototype.match=function(t,r){return t(this.value)},i.prototype._unsafeUnwrap=function(t){return this.value},i.prototype._unsafeUnwrapErr=function(t){throw Nt("Called `_unsafeUnwrapErr` on an Ok",this,t)},i}(),L=function(){function i(t){this.error=t}return p(i,"s"),i.prototype.isOk=function(){return!1},i.prototype.isErr=function(){return!this.isOk()},i.prototype.map=function(t){return I(this.error)},i.prototype.mapErr=function(t){return I(t(this.error))},i.prototype.andThen=function(t){return I(this.error)},i.prototype.orElse=function(t){return t(this.error)},i.prototype.asyncAndThen=function(t){return Et(this.error)},i.prototype.asyncMap=function(t){return Et(this.error)},i.prototype.unwrapOr=function(t){return t},i.prototype.match=function(t,r){return r(this.error)},i.prototype._unsafeUnwrap=function(t){throw Nt("Called `_unsafeUnwrap` on an Err",this,t)},i.prototype._unsafeUnwrapErr=function(t){return this.error},i}(),fe=ht.fromThrowable;function lt(i){let t=pr(i);return new hr.default(t).valueOf()*Math.PI}p(lt,"j");function pr(i){return i.replace(/(\d+)π/g,"$1").replace(/π/g,"1")}p(pr,"ur");var It=[{character:"\xBD",ref:"\xBD",expanded:"1/2",value:.5},{character:"\xBC",ref:"\xBC",expanded:"1/4",value:.25},{character:"\xBE",ref:"\xBE",expanded:"3/4",value:.75},{character:"\u2153",ref:"\u2153",expanded:"1/3",value:.3333333333333333},{character:"\u2154",ref:"\u2154",expanded:"2/3",value:.6666666666666666},{character:"\u2155",ref:"\u2155",expanded:"1/5",value:.2},{character:"\u2156",ref:"\u2156",expanded:"2/5",value:.4},{character:"\u2157",ref:"\u2157",expanded:"3/5",value:.6},{character:"\u2158",ref:"\u2158",expanded:"4/5",value:.8},{character:"\u2159",ref:"\u2159",expanded:"1/6",value:.16666666666666666},{character:"\u215A",ref:"\u215A",expanded:"5/6",value:.8333333333333334},{character:"\u2150",ref:"\u2150",expanded:"1/7",value:.14285714285714285},{character:"\u215B",ref:"\u215B",expanded:"1/8",value:.125},{character:"\u215C",ref:"\u215C",expanded:"3/8",value:.375},{character:"\u215D",ref:"\u215D",expanded:"5/8",value:.625},{character:"\u215E",ref:"\u215E",expanded:"7/8",value:.875},{character:"\u2151",ref:"\u2151",expanded:"1/9",value:.1111111111111111},{character:"\u2152",ref:"\u2152",expanded:"1/10",value:.1}],P=class _{static{p(this,"D")}static parseFloat(t){if(t.length===0)throw new Error(`Not a number: '${t}'`);if(t[0]==="-")return-_.parseFloat(t.substr(1));if(t[0]==="\u221A")return Math.sqrt(_.parseFloat(t.substr(1)));let r=_.matchUnicodeFraction(n=>n.character===t);if(r!==void 0)return r.value;let e=parseFloat(t);if(isNaN(e))throw new Error(`Not a number: '${t}'`);return e}static simplifyByRounding(t,r){if(t<0)return-_.simplifyByRounding(-t,r);let e=t%1;if(e<=r||1-e<=r)return Math.round(t);let n=_.matchUnicodeFraction(f=>Math.abs(f.value-t)<=r);if(n!==void 0)return n.value;let o=_.matchUnicodeFraction(f=>Math.abs(Math.sqrt(f.value)-t)<=r);return o!==void 0?Math.sqrt(o.value):t}static matchUnicodeFraction(t){for(let r of It)if(t(r))return r}constructor(t,r,e,n){this.allowAbbreviation=t,this.maxAbbreviationError=r,this.fixedDigits=e,this.itemSeparator=n}formatFloat(t){return this.allowAbbreviation?this.abbreviateFloat(t,this.maxAbbreviationError,this.fixedDigits):this.fixedDigits!==void 0?t.toFixed(this.fixedDigits):String(t)}abbreviateFloat(t,r=0,e=void 0){if(Math.abs(t)<r)return"0";if(t<0)return`-${this.abbreviateFloat(-t,r,e)}`;let n=_.matchUnicodeFraction(f=>Math.abs(f.value-t)<=r);if(n!==void 0)return n.character;let o=_.matchUnicodeFraction(f=>Math.abs(Math.sqrt(f.value)-t)<=r);return o!==void 0?`\u221A${o.character}`:t%1!==0&&e!==void 0?t.toFixed(e):t.toString()}};P.CONSISTENT=new P(!1,0,2,", "),P.EXACT=new P(!0,0,void 0,", "),P.MINIFIED=new P(!0,0,void 0,","),P.SIMPLIFIED=new P(!0,5e-4,3,", ");var vr=P,Mt=class mt{static{p(this,"J")}static matchUnicodeFraction(t){for(let r of It)if(t(r))return r}constructor(t,r,e,n=", "){this.allowAbbreviation=t,this.maxAbbreviationError=r,this.fixedDigits=e,this.itemSeparator=n}format(t){return this.allowAbbreviation?this.abbreviateNumber(t,this.maxAbbreviationError,this.fixedDigits):this.fixedDigits!==void 0?t.toFixed(this.fixedDigits):String(t)}abbreviateNumber(t,r=0,e=void 0){if(Math.abs(t)<r)return"0";if(t<0)return`-${this.abbreviateNumber(-t,r,e)}`;let n=mt.matchUnicodeFraction(f=>Math.abs(f.value-t)<=r);if(n!==void 0)return n.character;let o=mt.matchUnicodeFraction(f=>Math.abs(Math.sqrt(f.value)-t)<=r);return o!==void 0?`\u221A${o.character}`:t%1!==0&&e!==void 0?t.toFixed(e):t.toString()}},nt={allowAbbreviation:!0,maxAbbreviationError:0,fixedDigits:void 0},Z=class O{static{p(this,"E")}constructor(t,r){this.isEqualTo=this.eq.bind(this),this.isApproximatelyEqualTo=this.nearlyEq.bind(this),this.conj=this.conjugate.bind(this),this.plus=this.add.bind(this),this.subtract=this.sub.bind(this),this.minus=this.sub.bind(this),this.multiply=this.mult.bind(this),this.times=this.mult.bind(this),this.dividedBy=this.div.bind(this),this.magnitude=this.abs.bind(this),this.norm2=this.abs2.bind(this),this.angle=this.arg.bind(this),this.phase=this.arg.bind(this),this.real=t,this.imag=r,this.isApproximatelyEqualTo=this.nearlyEq,this.isEqualTo=this.eq,this.conj=this.conjugate,this.plus=this.add,this.subtract=this.sub,this.minus=this.sub,this.multiply=this.mult,this.times=this.mult,this.dividedBy=this.div,this.magnitude=this.abs,this.norm2=this.abs2,this.angle=this.arg,this.phase=this.arg}static from(t){return typeof t=="number"?new O(t,0):t}static real(t){return typeof t=="number"?t:t.real}static imag(t){return typeof t=="number"?0:t.imag}static polar(t,r){let[e,n]=this.cosAndSin(r);return new O(t*e,t*n)}static cosAndSin(t){let r=Math.PI/4,e=Math.round(t/r);if(e*r===t){let n=Math.sqrt(.5);return[[1,0],[n,n],[0,1],[-n,n],[-1,0],[-n,-n],[0,-1],[n,-n]][e&7]}return[Math.cos(t),Math.sin(t)]}eq(t){return typeof t=="number"?this.real===t&&this.imag===0:t instanceof O?this.real===t.real&&this.imag===t.imag:!1}nearlyEq(t,r){if(typeof t=="number"||t instanceof O){let e=this.sub(O.from(t));return Math.abs(e.real)<=r&&Math.abs(e.imag)<=r&&e.abs()<=r}return!1}conjugate(){return new O(this.real,-this.imag)}neg(){return new O(-this.real,-this.imag)}add(t){let r=O.from(t);return new O(this.real+r.real,this.imag+r.imag)}sub(t){let r=O.from(t);return new O(this.real-r.real,this.imag-r.imag)}mult(t){let r=O.from(t);return new O(this.real*r.real-this.imag*r.imag,this.real*r.imag+this.imag*r.real)}div(t){let r=O.from(t),e=r.abs2();if(e===0)return I(Error("Division by Zero"));let n=this.mult(r.conjugate());return R(new O(n.real/e,n.imag/e))}abs(){return Math.sqrt(this.abs2())}abs2(){return this.real*this.real+this.imag*this.imag}arg(){return Math.atan2(this.imag,this.real)}pow(t){return t===.5&&this.imag===0&&this.real>=0?new O(Math.sqrt(this.real),0):this.eq(O.ZERO)?O.ZERO:this.ln().mult(O.from(t)).exp()}exp(){return O.polar(Math.exp(this.real),this.imag)}format(t=nt){let r=new Mt(t.allowAbbreviation===void 0?nt.allowAbbreviation:t.allowAbbreviation,t.maxAbbreviationError||0,t.fixedDigits);return r.allowAbbreviation?this.toStringAllowSingleValue(r):this.toStringBothValues(r)}toString(){let t=new Mt(nt.allowAbbreviation,nt.maxAbbreviationError,nt.fixedDigits);return this.toStringAllowSingleValue(t)}ln(){return new O(Math.log(this.abs()),this.arg())}toStringAllowSingleValue(t){if(this.canImagPartBeOmitted(t.maxAbbreviationError))return t.format(this.real);if(this.canRealPartBeOmitted(t.maxAbbreviationError)){let r;return this.isImagFactorCloseToOne(t.maxAbbreviationError)?r="":this.isImagFactorMinusOne(t.maxAbbreviationError)?r="-":r=t.format(this.imag),`${r}i`}return this.toStringBothValues(t)}toStringBothValues(t){let r=this.imag>=0?"+":"-",e=this.canImagFactorBeOmitted(t)?"":t.format(Math.abs(this.imag));return`${(t.allowAbbreviation||t.fixedDigits===void 0||this.real<0?"":"+")+t.format(this.real)+r+e}i`}canRealPartBeOmitted(t){return Math.abs(this.real)<=t}canImagPartBeOmitted(t){return Math.abs(this.imag)<=t}isImagFactorCloseToOne(t){return Math.abs(this.imag-1)<=t}isImagFactorMinusOne(t){return Math.abs(this.imag+1)<=t}canImagFactorBeOmitted(t){return t.allowAbbreviation&&Math.abs(Math.abs(this.imag)-1)<=t.maxAbbreviationError}};Z.ZERO=new Z(0,0),Z.ONE=new Z(1,0),Z.I=new Z(0,1);var q=Z,mr=p(()=>({message:"Parse Error"}),"hr"),Tt=class Ft{static{p(this,"pt")}static need(t,r,e){if(t!==!0){let n=e===void 0?"(not provided)":`[${Array.prototype.slice.call(e).join(", ")}]`,o=`Precondition failed

Message: ${r===void 0?"(not provided)":r}

Args: ${n}`;throw new Error(o)}}static notNull(t){Ft.need(t!=null,"notNull")}static get urlJson(){let t=new URL(location.href,window.location.origin),r=decodeURIComponent(t.pathname),e=r.lastIndexOf("/");return r.substring(e+1)}};Tt.safeJsonParse=ht.fromThrowable(JSON.parse,mr);var D=Tt,gr="Bloch",br="\u2022",wr="H",xr="Measure",yr="P",Er="QFT\u2020",Mr="QFT",Ar="X^\xBD",Nr="Rx",Sr="Ry",Or="Rz",Ir="S\u2020",Tr="S",Fr="\u2026",kr="Swap",Ur="T\u2020",Rr="T",Cr="|0>",qr="|1>",Dr="X",Br="Y",Pr="Z",_r={allowAbbreviation:!0,maxAbbreviationError:5e-4,fixedDigits:void 0,itemSeparator:", "},T=class U{static{p(this,"s")}constructor(t,r,e){this.plus=this.add.bind(this),this.height=t,this.width=r,this.buffer=e,this.plus=this.add}static rows(t){let r=t.length;if(r===0)return I(Error("rows is empty"));let e=t[0].length;return t[0].length===0?I(Error("rows[0] is empty")):U.build(r,e,(n,o)=>t[n][o])}static column_vector(...t){return U.build(t.length,1,r=>t[r])}static build(t,r,e){let n=new Float64Array(r*t*2);for(let o=0;o<t;o++)for(let f=0;f<r;f++){let m=(o*r+f)*2,x=m+1,c;e?c=q.from(e(o,f)):c=q.from(0),n[m]=c.real,n[x]=c.imag}return U.create(t,r,n)}static create(t,r,e){return r<0?I(Error(`width(${r}) < 0`)):t<0?I(Error(`height(${t}) < 0`)):r*t*2!==e.length?I(Error(`width(${r})*height(${t})*2 !== buffer.length(${e.length})`)):R(new U(t,r,e))}element(t,r){if(t<0||r<0||t>=this.height||r>=this.width)return I(Error("Element out of range"));let e=(this.width*t+r)*2,n=e+1;return R(new q(this.buffer[e],this.buffer[n]))}set(t,r,e){if(t<0||r<0||t>=this.height||r>=this.width)return I(Error("Element out of range"));let n=(this.width*t+r)*2,o=n+1;return this.buffer[n]=e.real,this.buffer[o]=e.imag,R(this)}column(t){if(t<0)return I(Error("colIndex < 0"));if(t>this.width)return I(Error("colIndex > this.width"));let r=[];for(let e=0;e<this.height;e++){let n=this.element(e,t);if(n.isErr())return I(n.error);r.push(n.value)}return R(r)}add(t){if(t.width!==this.width||t.height!==this.height)return I(Error("Incompatible sizes"));let r=new Float64Array(this.buffer.length);for(let e=0;e<r.length;e++)r[e]=this.buffer[e]+t.buffer[e];return R(new U(this.height,this.width,r))}sub(t){if(t.width!==this.width||t.height!==this.height)return I(Error("Incompatible sizes"));let r=new Float64Array(this.buffer.length);for(let e=0;e<r.length;e++)r[e]=this.buffer[e]-t.buffer[e];return R(new U(this.height,this.width,r))}mult(t){return t instanceof U?this.multMatrix(t):R(this.multScalar(t))}applyControlledGate(t,r,e=[],n=[]){let{width:o,height:f,buffer:m}=this;for(let A of e)D.need(A>=0,"control bit out of range"),D.need(f>=2<<A,"control bit out of range");for(let A of n)D.need(A>=0,"anti control bit out of range"),D.need(f>=2<<A,"anti control bit out of range");let x=e.concat(n).reduce((A,S)=>A|1<<S,0),c=e.reduce((A,S)=>A|1<<S,0);D.need((c&1<<r)===0,"Matrix.timesQubitOperation: self-controlled"),D.need(t.width===2&&t.height===2,"Matrix.timesQubitOperation: not 2x2");let[y,g,h,l,a,s,u,d]=t.buffer;D.need(r>=0,"target bit out of range"),D.need(f>=2<<r,"target bit out of range");let v=new Float64Array(m),N=0;for(let A=0;A<f;A++){let S=(A&1<<r)!==0,M=(x&A^c)===0;for(let E=0;E<o;E++){if(M&&!S){let w=N+(1<<r)*2*o,b=v[N],C=v[N+1],k=v[w],B=v[w+1];v[N]=b*y-C*g+k*h-B*l,v[N+1]=b*g+C*y+k*l+B*h,v[w]=b*a-C*s+k*u-B*d,v[w+1]=b*s+C*a+k*d+B*u}N+=2}}return U.create(f,o,v)._unsafeUnwrap()}timesQubitOperation(t,r,e){D.need((e&1<<r)===0,"Matrix.timesQubitOperation: self-controlled"),D.need(t.width===2&&t.height===2,"Matrix.timesQubitOperation: not 2x2");let{width:n,height:o,buffer:f}=this,[m,x,c,y,g,h,l,a]=t.buffer;D.need(o>=2<<r,"Matrix.timesQubitOperation: qubit index out of range");let s=new Float64Array(f),u=0;for(let d=0;d<o;d++){let v=(e&d^e)!==0,N=(d&1<<r)!==0;for(let A=0;A<n;A++){if(!v&&!N){let S=u+(1<<r)*2*n,M=s[u],E=s[u+1],w=s[S],b=s[S+1];s[u]=M*m-E*x+w*c-b*y,s[u+1]=M*x+E*m+w*y+b*c,s[S]=M*g-E*h+w*l-b*a,s[S+1]=M*h+E*g+w*a+b*l}u+=2}}return U.create(o,n,s)._unsafeUnwrap()}rows(){return st(0,this.height-1).map(t=>st(0,this.width-1).map(r=>this.element(t,r)._unsafeUnwrap()))}isHermitian(t=0){if(this.width!==this.height)return!1;for(let r=0;r<this.width;r++)for(let e=0;e<this.height;e++){let n=(this.width*e+r)*2,o=(this.width*r+e)*2;if(Math.abs(this.buffer[n]-this.buffer[o])>t||Math.abs(this.buffer[n+1]+this.buffer[o+1])>t)return!1}return!0}trace(){let t=0,r=0,e=this.width*2+2;for(let n=0;n<this.buffer.length;n+=e)t+=this.buffer[n],r+=this.buffer[n+1];return new q(t,r)}adjoint(){let t=this.height,r=this.width,e=new Float64Array(t*r*2);for(let n=0;n<r;n++)for(let o=0;o<t;o++){let f=(o*this.width+n)*2,m=(n*t+o)*2;e[m]=this.buffer[f],e[m+1]=-this.buffer[f+1]}return new U(r,t,e)}tensorProduct(t){let r=this.width,e=this.height,n=t.width,o=t.height,f=r*n,m=e*o,x=new Float64Array(f*m*2);for(let c=0;c<e;c++)for(let y=0;y<o;y++)for(let g=0;g<r;g++)for(let h=0;h<n;h++){let l=(c*r+g)*2,a=(y*n+h)*2,s=((c*o+y)*f+(g*n+h))*2,u=this.buffer[l],d=this.buffer[l+1],v=t.buffer[a],N=t.buffer[a+1],A=u*v-d*N,S=u*N+d*v;x[s]=A,x[s+1]=S}return new U(m,f,x)}eq(t){if(this===t)return!0;if(!(t instanceof U))return!1;let r=t;return this.width===r.width&&this.height===r.height&&st(0,this.buffer.length-1).every(e=>this.buffer[e]===r.buffer[e])}nearlyEq(t,r){return t instanceof U&&this.width===t.width&&this.height===t.height&&Math.sqrt(this.sub(t)._unsafeUnwrap().norm2())<=r}format(t=_r){let r=new vr(t.allowAbbreviation===void 0?!0:t.allowAbbreviation,t.maxAbbreviationError||0,t.fixedDigits,t.itemSeparator||", ");return`{{${this.rows().map(e=>e.map(n=>n.format(r)).join(r.itemSeparator)).join(`}${r.itemSeparator}{`)}}}`}toString(){return this.format()}qubitDensityMatrixToBlochVector(){if(this.width!==2||this.height!==2)throw new Error("Need a 2x2 density matrix.");if(!this.isHermitian(.01))throw new Error("Density matrix should be Hermitian.");if(!this.trace().nearlyEq(1,.01))throw new Error("Density matrix should have unit trace.");let[t,r,e,n,o,f,m,x]=this.buffer,c=o+e,y=f-n,g=t-m;return[c,y,g]}clone(){return new U(this.height,this.width,this.buffer.slice())}norm2(){let t=0;for(let r of this.buffer)t+=r*r;return t}multMatrix(t){if(this.width!==t.height)return I(Error("Incompatible sizes."));let r=t.width,e=this.height,n=this.width,o=new Float64Array(r*e*2);for(let f=0;f<e;f++)for(let m=0;m<r;m++){let x=(f*r+m)*2;for(let c=0;c<n;c++){let y=(f*n+c)*2,g=(c*r+m)*2,h=this.buffer[y],l=this.buffer[y+1],a=t.buffer[g],s=t.buffer[g+1],u=h*a-l*s,d=h*s+a*l;o[x]+=u,o[x+1]+=d}}return R(new U(e,r,o))}multScalar(t){let r=new Float64Array(this.buffer.length),e=q.real(t),n=q.imag(t);for(let o=0;o<r.length;o+=2){let f=this.buffer[o],m=this.buffer[o+1];r[o]=f*e-m*n,r[o+1]=f*n+m*e}return new U(this.height,this.width,r)}},z=q.I,K=z.neg(),Wr=T.rows([[1,1],[1,-1]])._unsafeUnwrap().mult(Math.sqrt(.5))._unsafeUnwrap(),$r=T.rows([[0,1],[1,0]])._unsafeUnwrap(),Gr=T.rows([[0,K],[z,0]])._unsafeUnwrap(),zr=T.rows([[1,0],[0,-1]])._unsafeUnwrap(),kt=T.rows([[1,0],[0,z]])._unsafeUnwrap(),jr=kt.adjoint(),Ut=T.rows([[1,0],[0,z.times(Math.PI/4).exp()]])._unsafeUnwrap(),Vr=Ut.adjoint();function Zr(i){let t=lt(i);return T.rows([[1,0],[0,z.times(t).exp()]])._unsafeUnwrap()}p(Zr,"Vt");var Lr=T.rows([[z.plus(1),K.plus(1)],[K.plus(1),z.plus(1)]])._unsafeUnwrap().mult(.5)._unsafeUnwrap();function Qr(i){let t=lt(i),r=Math.cos(t/2),e=Math.sin(t/2);return T.rows([[r,K.times(e)],[K.times(e),r]])._unsafeUnwrap()}p(Qr,"jt");function Xr(i){let t=lt(i),r=Math.cos(t/2),e=Math.sin(t/2);return T.rows([[r,-e],[e,r]])._unsafeUnwrap()}p(Xr,"Lt");function Hr(i){let t=lt(i);return T.rows([[K.times(t/2).exp(),0],[0,z.times(t/2).exp()]])._unsafeUnwrap()}p(Hr,"Qt");var Jr=class gt{static{p(this,"s")}constructor(t){this.toWolfram=this.toString.bind(this),typeof t=="string"?/^.*\|.+>$/.test(t)?this.matrix=this.ketstringToMatrix(t):this.matrix=this.bitstringToMatrix(t):this.matrix=t,this.size=this.matrix.height,this.nqubit=Math.log2(this.size),this.toWolfram=this.toString}get bra(){return this.matrix.adjoint()}get ket(){return this.matrix}amplifier(t){return this.matrix.element(t,0)._unsafeUnwrap()}setAmplifier(t,r){let e=this.matrix.set(t,0,r);return e.isErr()?I(Error(e.error.message)):R(this)}blochVector(t){return this.qubitDensityMatrix(t).qubitDensityMatrixToBlochVector()}isApproximatelyEqualTo(t,r){return t instanceof gt&&this.matrix.nearlyEq(t.matrix,r)}applyControlledGate(t,r,e=[],n=[]){return this.matrix=this.matrix.applyControlledGate(t,r,e,n),this.matrix}timesQubitOperation(t,r,e){return this.matrix=this.matrix.timesQubitOperation(t,r,e),this.matrix}toString(){return this.matrix.toString()}bitstringToMatrix(t){let r=!1,e="",n=[],o=new Error(`Invalid StateVector bit string: ${t}`);for(let f of t.split(""))switch(f){case"0":{if(r)throw o;n.push(T.column_vector(1,0)._unsafeUnwrap());break}case"1":{if(r)throw o;n.push(T.column_vector(0,1)._unsafeUnwrap());break}case"+":{if(r)throw o;n.push(T.column_vector(1,1)._unsafeUnwrap().mult(Math.sqrt(.5))._unsafeUnwrap());break}case"-":{r?e+="-":n.push(T.column_vector(1,-1)._unsafeUnwrap().mult(Math.sqrt(.5))._unsafeUnwrap());break}case"i":{r?e+="i":n.push(T.column_vector(1,new q(0,1))._unsafeUnwrap().mult(Math.sqrt(.5))._unsafeUnwrap());break}case"(":{if(r)throw o;r=!0,e="";break}case")":{if(!r||e!=="-i")throw o;n.push(T.column_vector(1,new q(0,-1))._unsafeUnwrap().mult(Math.sqrt(.5))._unsafeUnwrap()),r=!1;break}default:throw o}if(n.length===0)throw o;return n.reduce((f,m)=>f.tensorProduct(m))}ketstringToMatrix(t){let r=t.match(/^(.*)\|(.+)>$/);if(r===null)throw new Error(`ketString: invalid ket ${t}`);let e=r[1],n=r[2];if(e==="")return this.bitstringToMatrix(n);{let o;if(e==="-")o=-1;else if(e==="i")o=q.I;else if(e==="-i")o=q.I.times(-1);else throw new Error(`ketString: invalid coef ${e}`);let f=new gt(n).matrix.mult(o);if(f.isErr())throw new Error(`ketString: invalid ket ${n}`);return f.value}}qubitDensityMatrix(t){if(t<0||t>=this.nqubit)throw new Error(`Qubit index out of range: ${t}`);let r=[...Array(Math.log2(this.matrix.height)).keys()].filter(o=>o!==t),e=p((o,f)=>f.sort().reverse().reduce((m,x)=>{let c=m>>x+1;c=c<<x;let y=(1<<x)-1&m;return c|y},o),"e"),n=T.build(2,2)._unsafeUnwrap();for(let o=0;o<this.matrix.height;o++)for(let f=0;f<this.matrix.height;f++){if(!r.every(g=>(o>>g&1)===(f>>g&1)))continue;let m=this.matrix.element(f,0)._unsafeUnwrap().times(this.matrix.element(o,0)._unsafeUnwrap().conjugate());if(m.isEqualTo(0))continue;let x=e(f,r)===0?T.column_vector(1,0)._unsafeUnwrap():T.column_vector(0,1)._unsafeUnwrap(),c=e(o,r)===0?T.rows([[1,0]])._unsafeUnwrap():T.rows([[0,1]])._unsafeUnwrap(),y=x.mult(c)._unsafeUnwrap();n=n.add(y.mult(m)._unsafeUnwrap())._unsafeUnwrap()}return n}};function Yr(i,t){return Math.round(i*Math.pow(10,t))/Math.pow(10,t)}p(Yr,"Xt");var Rt=class{static{p(this,"Ht")}constructor(i){this.state=new Jr(i),this.measuredBits={},this.flags={},this.blochVectors={}}runStep(i){this.blochVectors={};for(let t of i)switch(t.type){case wr:if(t.if&&!this.flags[t.if])break;this.h(...t.targets,{controls:t.controls,antiControls:t.antiControls});break;case Dr:if(t.if&&!this.flags[t.if])break;this.x(...t.targets,{controls:t.controls,antiControls:t.antiControls});break;case Br:if(t.if&&!this.flags[t.if])break;this.y(...t.targets,{controls:t.controls,antiControls:t.antiControls});break;case Pr:if(t.if&&!this.flags[t.if])break;this.z(...t.targets,{controls:t.controls,antiControls:t.antiControls});break;case Ar:if(t.if&&!this.flags[t.if])break;this.rnot(...t.targets,{controls:t.controls,antiControls:t.antiControls});break;case Tr:{if(t.if&&!this.flags[t.if])break;this.s(...t.targets,{controls:t.controls,antiControls:t.antiControls});break}case Ir:{if(t.if&&!this.flags[t.if])break;this.sDagger(...t.targets,{controls:t.controls,antiControls:t.antiControls});break}case Rr:{if(t.if&&!this.flags[t.if])break;this.t(...t.targets,{controls:t.controls,antiControls:t.antiControls});break}case Ur:{if(t.if&&!this.flags[t.if])break;this.tDagger(...t.targets,{controls:t.controls,antiControls:t.antiControls});break}case yr:{if(!t.angle)throw new Error("angle is not set");if(t.if&&!this.flags[t.if])break;this.phase(t.angle,...t.targets,{controls:t.controls,antiControls:t.antiControls});break}case Nr:if(!t.angle)throw new Error("angle is not set");if(t.if&&!this.flags[t.if])break;this.rx(t.angle,...t.targets,{controls:t.controls,antiControls:t.antiControls});break;case Sr:if(!t.angle)throw new Error("angle is not set");if(t.if&&!this.flags[t.if])break;this.ry(t.angle,...t.targets,{controls:t.controls,antiControls:t.antiControls});break;case Or:if(!t.angle)throw new Error("angle is not set");if(t.if&&!this.flags[t.if])break;this.rz(t.angle,...t.targets,{controls:t.controls,antiControls:t.antiControls});break;case kr:{this.swap(t.targets[0],t.targets[1],{controls:t.controls});break}case br:{this.z(t.targets[0],{controls:t.targets.slice(1)});break}case gr:for(let r of t.targets)this.blochDisplay(r);break;case Cr:this.write(0,...t.targets);break;case qr:this.write(1,...t.targets);break;case xr:for(let r of t.targets)this.measure(r),t.flag&&(this.flags[t.flag]=this.measuredBits[r]===1);break;case Fr:break;case Mr:this.qft(t.span,...t.targets);break;case Er:this.qftDagger(t.span,...t.targets);break;default:throw new Error("Unknown instruction")}return this}h(...i){let{targets:t,controlOptions:r}=this.processGateArgs(i);return this.cu(Wr,t,r),this}x(...i){let{targets:t,controlOptions:r}=this.processGateArgs(i);return this.cu($r,t,r),this}y(...i){let{targets:t,controlOptions:r}=this.processGateArgs(i);return this.cu(Gr,t,r),this}z(...i){let{targets:t,controlOptions:r}=this.processGateArgs(i);return this.cu(zr,t,r),this}rnot(...i){let{targets:t,controlOptions:r}=this.processGateArgs(i);return this.cu(Lr,t,r),this}s(...i){let{targets:t,controlOptions:r}=this.processGateArgs(i);return this.cu(kt,t,r),this}sDagger(...i){let{targets:t,controlOptions:r}=this.processGateArgs(i);return this.cu(jr,t,r),this}t(...i){let{targets:t,controlOptions:r}=this.processGateArgs(i);return this.cu(Ut,t,r),this}tDagger(...i){let{targets:t,controlOptions:r}=this.processGateArgs(i);return this.cu(Vr,t,r),this}phase(i,...t){let{targets:r,controlOptions:e}=this.processGateArgs(t);return this.cu(Zr(i),r,e),this}rx(i,...t){let{targets:r,controlOptions:e}=this.processGateArgs(t);return this.cu(Qr(i),r,e),this}ry(i,...t){let{targets:r,controlOptions:e}=this.processGateArgs(t);return this.cu(Xr(i),r,e),this}rz(i,...t){let{targets:r,controlOptions:e}=this.processGateArgs(t);return this.cu(Hr(i),r,e),this}swap(i,t,r){let e=r?.controls||[];return this.x(t,{controls:e.concat([i])}).x(i,{controls:e.concat([t])}).x(t,{controls:e.concat([i])}),this}blochDisplay(i){let[t,r,e]=this.state.blochVector(i);return this.blochVectors[i]={x:t,y:r,z:e},this}write(i,...t){for(let r of t){let e=Yr(this.pZero(r),5);(i===0&&e===0||i===1&&e===1)&&this.x(r)}return this}measure(...i){for(let t of i){let r=this.pZero(t);if(Math.random()<=r){for(let e=0;e<1<<this.state.nqubit;e++){e&1<<t&&this.state.setAmplifier(e,q.ZERO);let n=this.state.amplifier(e).div(Math.sqrt(r));if(n.isErr())throw Error(n.error.message);this.state.setAmplifier(e,n.value)}this.measuredBits[t]=0}else{for(let e=0;e<1<<this.state.nqubit;e++){e&1<<t||this.state.setAmplifier(e,q.ZERO);let n=this.state.amplifier(e).div(Math.sqrt(1-r));if(n.isErr())throw Error(n.error.message);this.state.setAmplifier(e,n.value)}this.measuredBits[t]=1}}return this}qft(i,...t){for(let r of t)this.qftSingleTargetBit(i,r);return this}qftDagger(i,...t){for(let r of t)this.qftDaggerSingleTargetBit(i,r);return this}qftSingleTargetBit(i,t){for(let r=0;r<i;r++){this.h(t+r);for(let e=1;e<i-r;e++)this.phase(`\u03C0/${2**e}`,t+r,{controls:[t+r+e]})}return this}qftDaggerSingleTargetBit(i,t){for(let r=i-1;r>=0;r--){for(let e=i-r-1;e>0;e--)this.phase(`-\u03C0/${2**e}`,t+r,{controls:[t+r+e]});this.h(t+r)}return this}processGateArgs(i){let t=typeof i[i.length-1]=="object"?i.pop():{};return{targets:i,controlOptions:t}}cu(i,t,r){for(let e of t)this.state.applyControlledGate(i,e,r.controls,r.antiControls)}pZero(i){let t=0;for(let r=0;r<1<<this.state.nqubit;r++)r&1<<i||(t+=Math.pow(this.state.amplifier(r).abs(),2));return t}};var ne=Yt(qt());function wt(i,t,r,e){function n(o){return o instanceof r?o:new r(function(f){f(o)})}return p(n,"adopt"),new(r||(r=Promise))(function(o,f){function m(y){try{c(e.next(y))}catch(g){f(g)}}p(m,"fulfilled");function x(y){try{c(e.throw(y))}catch(g){f(g)}}p(x,"rejected");function c(y){y.done?o(y.value):n(y.value).then(m,x)}p(c,"step"),c((e=e.apply(i,t||[])).next())})}p(wt,"__awaiter");function xt(i,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},e,n,o,f;return f={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function m(c){return function(y){return x([c,y])}}function x(c){if(e)throw new TypeError("Generator is already executing.");for(;r;)try{if(e=1,n&&(o=c[0]&2?n.return:c[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,c[1])).done)return o;switch(n=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,n=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){r.label=c[1];break}if(c[0]===6&&r.label<o[1]){r.label=o[1],o=c;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(c);break}o[2]&&r.ops.pop(),r.trys.pop();continue}c=t.call(i,r)}catch(y){c=[6,y],n=0}finally{e=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}p(xt,"__generator");function ft(i,t){var r=typeof Symbol=="function"&&i[Symbol.iterator];if(!r)return i;var e=r.call(i),n,o=[],f;try{for(;(t===void 0||t-- >0)&&!(n=e.next()).done;)o.push(n.value)}catch(m){f={error:m}}finally{try{n&&!n.done&&(r=e.return)&&r.call(e)}finally{if(f)throw f.error}}return o}p(ft,"__read");function J(i,t,r){if(r||arguments.length===2)for(var e=0,n=t.length,o;e<n;e++)(o||!(e in t))&&(o||(o=Array.prototype.slice.call(t,0,e)),o[e]=t[e]);return i.concat(o||Array.prototype.slice.call(t))}p(J,"__spreadArray");var Kr={withStackTrace:!1},Bt=p(function(i,t,r){r===void 0&&(r=Kr);var e=t.isOk()?{type:"Ok",value:t.value}:{type:"Err",value:t.error},n=r.withStackTrace?new Error().stack:void 0;return{data:e,message:i,stack:n}},"createNeverThrowError"),rt=function(){function i(t){this._promise=t}return p(i,"ResultAsync"),i.fromSafePromise=function(t){var r=t.then(function(e){return new X(e)});return new i(r)},i.fromPromise=function(t,r){var e=t.then(function(n){return new X(n)}).catch(function(n){return new H(r(n))});return new i(e)},i.combine=function(t){return re(t)},i.combineWithAllErrors=function(t){return ee(t)},i.prototype.map=function(t){var r=this;return new i(this._promise.then(function(e){return wt(r,void 0,void 0,function(){var n;return xt(this,function(o){switch(o.label){case 0:return e.isErr()?[2,new H(e.error)]:(n=X.bind,[4,t(e.value)]);case 1:return[2,new(n.apply(X,[void 0,o.sent()]))]}})})}))},i.prototype.mapErr=function(t){var r=this;return new i(this._promise.then(function(e){return wt(r,void 0,void 0,function(){var n;return xt(this,function(o){switch(o.label){case 0:return e.isOk()?[2,new X(e.value)]:(n=H.bind,[4,t(e.error)]);case 1:return[2,new(n.apply(H,[void 0,o.sent()]))]}})})}))},i.prototype.andThen=function(t){return new i(this._promise.then(function(r){if(r.isErr())return new H(r.error);var e=t(r.value);return e instanceof i?e._promise:e}))},i.prototype.orElse=function(t){var r=this;return new i(this._promise.then(function(e){return wt(r,void 0,void 0,function(){return xt(this,function(n){return e.isErr()?[2,t(e.error)]:[2,new X(e.value)]})})}))},i.prototype.match=function(t,r){return this._promise.then(function(e){return e.match(t,r)})},i.prototype.unwrapOr=function(t){return this._promise.then(function(r){return r.unwrapOr(t)})},i.prototype.then=function(t,r){return this._promise.then(t,r)},i}();var Dt=p(function(i){return new rt(Promise.resolve(new H(i)))},"errAsync"),ge=rt.fromPromise,be=rt.fromSafePromise,te=p(function(i){return function(t){return J(J([],ft(t),!1),[i],!1)}},"appendValueToEndOfList"),Pt=p(function(i){return i.reduce(function(t,r){return t.isOk()?r.isErr()?$(r.error):t.map(te(r.value)):t},W([]))},"combineResultList"),re=p(function(i){return rt.fromSafePromise(Promise.all(i)).andThen(Pt)},"combineResultAsyncList"),_t=p(function(i){return i.reduce(function(t,r){return r.isErr()?t.isErr()?$(J(J([],ft(t.error),!1),[r.error],!1)):$([r.error]):t.isErr()?t:W(J(J([],ft(t.value),!1),[r.value],!1))},W([]))},"combineResultListWithAllErrors"),ee=p(function(i){return rt.fromSafePromise(Promise.all(i)).andThen(_t)},"combineResultAsyncListWithAllErrors"),it;(function(i){function t(n,o){return function(){for(var f=[],m=0;m<arguments.length;m++)f[m]=arguments[m];try{var x=n.apply(void 0,J([],ft(f),!1));return W(x)}catch(c){return $(o?o(c):c)}}}p(t,"fromThrowable"),i.fromThrowable=t;function r(n){return Pt(n)}p(r,"combine"),i.combine=r;function e(n){return _t(n)}p(e,"combineWithAllErrors"),i.combineWithAllErrors=e})(it||(it={}));var W=p(function(i){return new X(i)},"ok"),$=p(function(i){return new H(i)},"err"),X=function(){function i(t){this.value=t}return p(i,"Ok"),i.prototype.isOk=function(){return!0},i.prototype.isErr=function(){return!this.isOk()},i.prototype.map=function(t){return W(t(this.value))},i.prototype.mapErr=function(t){return W(this.value)},i.prototype.andThen=function(t){return t(this.value)},i.prototype.orElse=function(t){return W(this.value)},i.prototype.asyncAndThen=function(t){return t(this.value)},i.prototype.asyncMap=function(t){return rt.fromSafePromise(t(this.value))},i.prototype.unwrapOr=function(t){return this.value},i.prototype.match=function(t,r){return t(this.value)},i.prototype._unsafeUnwrap=function(t){return this.value},i.prototype._unsafeUnwrapErr=function(t){throw Bt("Called `_unsafeUnwrapErr` on an Ok",this,t)},i}(),H=function(){function i(t){this.error=t}return p(i,"Err"),i.prototype.isOk=function(){return!1},i.prototype.isErr=function(){return!this.isOk()},i.prototype.map=function(t){return $(this.error)},i.prototype.mapErr=function(t){return $(t(this.error))},i.prototype.andThen=function(t){return $(this.error)},i.prototype.orElse=function(t){return t(this.error)},i.prototype.asyncAndThen=function(t){return Dt(this.error)},i.prototype.asyncMap=function(t){return Dt(this.error)},i.prototype.unwrapOr=function(t){return t},i.prototype.match=function(t,r){return r(this.error)},i.prototype._unsafeUnwrap=function(t){throw Bt("Called `_unsafeUnwrap` on an Err",this,t)},i.prototype._unsafeUnwrapErr=function(t){return this.error},i}(),we=it.fromThrowable;var $t=[{character:"\xBD",ref:"\xBD",expanded:"1/2",value:.5},{character:"\xBC",ref:"\xBC",expanded:"1/4",value:.25},{character:"\xBE",ref:"\xBE",expanded:"3/4",value:.75},{character:"\u2153",ref:"\u2153",expanded:"1/3",value:.3333333333333333},{character:"\u2154",ref:"\u2154",expanded:"2/3",value:.6666666666666666},{character:"\u2155",ref:"\u2155",expanded:"1/5",value:.2},{character:"\u2156",ref:"\u2156",expanded:"2/5",value:.4},{character:"\u2157",ref:"\u2157",expanded:"3/5",value:.6},{character:"\u2158",ref:"\u2158",expanded:"4/5",value:.8},{character:"\u2159",ref:"\u2159",expanded:"1/6",value:.16666666666666666},{character:"\u215A",ref:"\u215A",expanded:"5/6",value:.8333333333333334},{character:"\u2150",ref:"\u2150",expanded:"1/7",value:.14285714285714285},{character:"\u215B",ref:"\u215B",expanded:"1/8",value:.125},{character:"\u215C",ref:"\u215C",expanded:"3/8",value:.375},{character:"\u215D",ref:"\u215D",expanded:"5/8",value:.625},{character:"\u215E",ref:"\u215E",expanded:"7/8",value:.875},{character:"\u2151",ref:"\u2151",expanded:"1/9",value:.1111111111111111},{character:"\u2152",ref:"\u2152",expanded:"1/10",value:.1}],j=class G{static{p(this,"o")}static parseFloat(t){if(t.length===0)throw new Error(`Not a number: '${t}'`);if(t[0]==="-")return-G.parseFloat(t.substr(1));if(t[0]==="\u221A")return Math.sqrt(G.parseFloat(t.substr(1)));let r=G.matchUnicodeFraction(n=>n.character===t);if(r!==void 0)return r.value;let e=parseFloat(t);if(isNaN(e))throw new Error(`Not a number: '${t}'`);return e}static simplifyByRounding(t,r){if(t<0)return-G.simplifyByRounding(-t,r);let e=t%1;if(e<=r||1-e<=r)return Math.round(t);let n=G.matchUnicodeFraction(f=>Math.abs(f.value-t)<=r);if(n!==void 0)return n.value;let o=G.matchUnicodeFraction(f=>Math.abs(Math.sqrt(f.value)-t)<=r);return o!==void 0?Math.sqrt(o.value):t}static matchUnicodeFraction(t){for(let r of $t)if(t(r))return r}constructor(t,r,e,n){this.allowAbbreviation=t,this.maxAbbreviationError=r,this.fixedDigits=e,this.itemSeparator=n}formatFloat(t){return this.allowAbbreviation?this.abbreviateFloat(t,this.maxAbbreviationError,this.fixedDigits):this.fixedDigits!==void 0?t.toFixed(this.fixedDigits):String(t)}abbreviateFloat(t,r=0,e=void 0){if(Math.abs(t)<r)return"0";if(t<0)return`-${this.abbreviateFloat(-t,r,e)}`;let n=G.matchUnicodeFraction(f=>Math.abs(f.value-t)<=r);if(n!==void 0)return n.character;let o=G.matchUnicodeFraction(f=>Math.abs(Math.sqrt(f.value)-t)<=r);return o!==void 0?`\u221A${o.character}`:t%1!==0&&e!==void 0?t.toFixed(e):t.toString()}};j.CONSISTENT=new j(!1,0,2,", "),j.EXACT=new j(!0,0,void 0,", "),j.MINIFIED=new j(!0,0,void 0,","),j.SIMPLIFIED=new j(!0,5e-4,3,", ");var Wt=class yt{static{p(this,"n")}static matchUnicodeFraction(t){for(let r of $t)if(t(r))return r}constructor(t,r,e,n=", "){this.allowAbbreviation=t,this.maxAbbreviationError=r,this.fixedDigits=e,this.itemSeparator=n}format(t){return this.allowAbbreviation?this.abbreviateNumber(t,this.maxAbbreviationError,this.fixedDigits):this.fixedDigits!==void 0?t.toFixed(this.fixedDigits):String(t)}abbreviateNumber(t,r=0,e=void 0){if(Math.abs(t)<r)return"0";if(t<0)return`-${this.abbreviateNumber(-t,r,e)}`;let n=yt.matchUnicodeFraction(f=>Math.abs(f.value-t)<=r);if(n!==void 0)return n.character;let o=yt.matchUnicodeFraction(f=>Math.abs(Math.sqrt(f.value)-t)<=r);return o!==void 0?`\u221A${o.character}`:t%1!==0&&e!==void 0?t.toFixed(e):t.toString()}},at={allowAbbreviation:!0,maxAbbreviationError:0,fixedDigits:void 0},et=class F{static{p(this,"a")}constructor(t,r){this.isEqualTo=this.eq.bind(this),this.isApproximatelyEqualTo=this.nearlyEq.bind(this),this.conj=this.conjugate.bind(this),this.plus=this.add.bind(this),this.subtract=this.sub.bind(this),this.minus=this.sub.bind(this),this.multiply=this.mult.bind(this),this.times=this.mult.bind(this),this.dividedBy=this.div.bind(this),this.magnitude=this.abs.bind(this),this.norm2=this.abs2.bind(this),this.angle=this.arg.bind(this),this.phase=this.arg.bind(this),this.real=t,this.imag=r,this.isApproximatelyEqualTo=this.nearlyEq,this.isEqualTo=this.eq,this.conj=this.conjugate,this.plus=this.add,this.subtract=this.sub,this.minus=this.sub,this.multiply=this.mult,this.times=this.mult,this.dividedBy=this.div,this.magnitude=this.abs,this.norm2=this.abs2,this.angle=this.arg,this.phase=this.arg}static from(t){return typeof t=="number"?new F(t,0):t}static real(t){return typeof t=="number"?t:t.real}static imag(t){return typeof t=="number"?0:t.imag}static polar(t,r){let[e,n]=this.cosAndSin(r);return new F(t*e,t*n)}static cosAndSin(t){let r=Math.PI/4,e=Math.round(t/r);if(e*r===t){let n=Math.sqrt(.5);return[[1,0],[n,n],[0,1],[-n,n],[-1,0],[-n,-n],[0,-1],[n,-n]][e&7]}return[Math.cos(t),Math.sin(t)]}eq(t){return typeof t=="number"?this.real===t&&this.imag===0:t instanceof F?this.real===t.real&&this.imag===t.imag:!1}nearlyEq(t,r){if(typeof t=="number"||t instanceof F){let e=this.sub(F.from(t));return Math.abs(e.real)<=r&&Math.abs(e.imag)<=r&&e.abs()<=r}return!1}conjugate(){return new F(this.real,-this.imag)}neg(){return new F(-this.real,-this.imag)}add(t){let r=F.from(t);return new F(this.real+r.real,this.imag+r.imag)}sub(t){let r=F.from(t);return new F(this.real-r.real,this.imag-r.imag)}mult(t){let r=F.from(t);return new F(this.real*r.real-this.imag*r.imag,this.real*r.imag+this.imag*r.real)}div(t){let r=F.from(t),e=r.abs2();if(e===0)return $(Error("Division by Zero"));let n=this.mult(r.conjugate());return W(new F(n.real/e,n.imag/e))}abs(){return Math.sqrt(this.abs2())}abs2(){return this.real*this.real+this.imag*this.imag}arg(){return Math.atan2(this.imag,this.real)}pow(t){return t===.5&&this.imag===0&&this.real>=0?new F(Math.sqrt(this.real),0):this.eq(F.ZERO)?F.ZERO:this.ln().mult(F.from(t)).exp()}exp(){return F.polar(Math.exp(this.real),this.imag)}format(t=at){let r=new Wt(t.allowAbbreviation===void 0?at.allowAbbreviation:t.allowAbbreviation,t.maxAbbreviationError||0,t.fixedDigits);return r.allowAbbreviation?this.toStringAllowSingleValue(r):this.toStringBothValues(r)}toString(){let t=new Wt(at.allowAbbreviation,at.maxAbbreviationError,at.fixedDigits);return this.toStringAllowSingleValue(t)}ln(){return new F(Math.log(this.abs()),this.arg())}toStringAllowSingleValue(t){if(this.canImagPartBeOmitted(t.maxAbbreviationError))return t.format(this.real);if(this.canRealPartBeOmitted(t.maxAbbreviationError)){let r;return this.isImagFactorCloseToOne(t.maxAbbreviationError)?r="":this.isImagFactorMinusOne(t.maxAbbreviationError)?r="-":r=t.format(this.imag),`${r}i`}return this.toStringBothValues(t)}toStringBothValues(t){let r=this.imag>=0?"+":"-",e=this.canImagFactorBeOmitted(t)?"":t.format(Math.abs(this.imag));return`${(t.allowAbbreviation||t.fixedDigits===void 0||this.real<0?"":"+")+t.format(this.real)+r+e}i`}canRealPartBeOmitted(t){return Math.abs(this.real)<=t}canImagPartBeOmitted(t){return Math.abs(this.imag)<=t}isImagFactorCloseToOne(t){return Math.abs(this.imag-1)<=t}isImagFactorMinusOne(t){return Math.abs(this.imag+1)<=t}canImagFactorBeOmitted(t){return t.allowAbbreviation&&Math.abs(Math.abs(this.imag)-1)<=t.maxAbbreviationError}};et.ZERO=new et(0,0),et.ONE=new et(1,0),et.I=new et(0,1);var ie=p(()=>({message:"Parse Error"}),"z"),Gt=class zt{static{p(this,"b")}static need(t,r,e){if(t!==!0){let n=e===void 0?"(not provided)":`[${Array.prototype.slice.call(e).join(", ")}]`,o=`Precondition failed

Message: ${r===void 0?"(not provided)":r}

Args: ${n}`;throw new Error(o)}}static notNull(t){zt.need(t!=null,"notNull")}static get urlJson(){let t=new URL(location.href,window.location.origin),r=decodeURIComponent(t.pathname),e=r.lastIndexOf("/");return r.substring(e+1)}};Gt.safeJsonParse=it.fromThrowable(JSON.parse,ie);var ot=Gt;var Y={};function ae(i){let t=i.data.circuitJson,r=i.data.qubitCount,e=i.data.stepIndex,n=i.data.steps,o=i.data.targets,f=i.data.invalidateCaches,m=new Rt("0".repeat(r));ot.notNull(r),ot.notNull(e),ot.notNull(n),ot.notNull(o),(Y[t]===void 0||f)&&(Y={},Y[t]={});for(let[x,c]of n.entries()){let y={};Y[t][x]===void 0&&(Y[t][x]={});let g=Y[t][x];if(g===void 0||g.targets===void 0||g.targets.length<o.length){m.runStep(c);let h=m.state.matrix.clone(),l=Object.assign({},m.blochVectors),a=Object.assign({},m.measuredBits),s=Object.assign({},m.flags);if(Y[t][x]={type:"step",step:x,amplitudes:h,targets:o,blochVectors:l,measuredBits:a,flags:s},x===e){let u=jt(o,h);y={type:"step",step:x,amplitudes:u,blochVectors:l,measuredBits:a,flags:s}}else y={type:"step",step:x,amplitudes:[],blochVectors:l,measuredBits:a,flags:s}}else y={type:"step",step:x,amplitudes:[],blochVectors:g.blochVectors,measuredBits:g.measuredBits,flags:g.flags},x===e&&(y.amplitudes=jt(o,g.amplitudes));self.postMessage(y)}self.postMessage({type:"finish"})}p(ae,"runSimulator");var jt=p((i,t)=>i.reduce((r,e)=>{if(e>=t.height)r[e]=[0,0];else{let n=t.element(e,0).value;r[e]=[n.real,n.imag]}return r},{}),"pickTargetAmplitudes");self.addEventListener("message",ae);})();
/*! Bundled license information:

fraction.js/fraction.js:
  (**
   * @license Fraction.js v4.2.0 05/03/2022
   * https://www.xarg.org/2014/03/rational-numbers-in-javascript/
   *
   * Copyright (c) 2021, Robert Eisele (robert@xarg.org)
   * Dual licensed under the MIT or GPL Version 2 licenses.
   **)
*/
/*! Bundled license information:

fraction.js/fraction.js:
  (**
   * @license Fraction.js v4.2.0 05/03/2022
   * https://www.xarg.org/2014/03/rational-numbers-in-javascript/
   *
   * Copyright (c) 2021, Robert Eisele (robert@xarg.org)
   * Dual licensed under the MIT or GPL Version 2 licenses.
   **)
*/
//# sourceMappingURL=serviceworker.js.map
